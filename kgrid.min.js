(function(d){d.fn.kgrid=function(w){var b=d(this),q=function(a,c){return b},r=function(a){return b},m=function(a){b.kgrid("items",a.items);b.empty();t();u(a);if(0!=b.data("kgrid").type)a:{v(a),d("#"+b.attr("id")+"-page-info").remove();var c=0,c=b.data("kgrid").type;if(1==c)c=a.total;else if(2==c)c=a.items.length;else break a;if(0!=c){a=b.data("kgrid").pageSize;var e=Math.floor((c-1)/a+1),g=b.data("kgrid").pageNow,f="<nav id='"+b.attr("id")+"-page-info' class='pull-right'>",f=f+"<ul class='pagination'>"+
    ("<li><a href='javascript:' style='color: #000;cursor: default;'>"+g+" of "+e+" page, "+((g-1)*a+1)+"~"+g*a+" of "+c+" item</a></li>"),f=f+"</ul></nav>";b.after(f)}}return b},t=function(){var a="<thead><tr>";b.data("kgrid").multi&&(a+="<th><input type='checkbox' class='"+b.attr("id")+"-checkbox-all'/></th>");var c=b.data("kgrid").fields;d.each(c,function(b,c){a+="<th>"+c+"</th>"});a+="</tr></thead>";b.append(a);d("."+b.attr("id")+"-checkbox-all").click(function(){var a=d("."+b.attr("id")+"-checkbox-item");
    0<d("."+b.attr("id")+"-checkbox-all:checked").length?a.prop("checked",!0):a.prop("checked",!1)});return b},u=function(a){var c="<tbody>",e=a.items,g=b.data("kgrid").fields;e&&0!=e.length||(c+="<tr class='no-item'><td colspan='100'><div style='padding: 40px 0px;font-size: 14px;text-align: center;'>"+b.data("kgrid").empty+"</div></td></tr>");if(2==b.data("kgrid").type){var f=b.data("kgrid").pageNow,h=b.data("kgrid").pageSize;a=a.items.length;for(var l=(f-1)*h;l<f*h&&l<a;l++){var k=e[l],c=c+"<tr style='cursor: pointer;'>",
    m=b.data("kgrid").multi;m&&(c+="<td><input type='checkbox' class='"+b.attr("id")+"-checkbox-item'/></td>");d.each(g,function(b,a){d.each(k,function(a,d){b==a&&(c+="<td>"+d+"</td>")})});c+="</tr>"}}else for(l=0;e&&l<e.length;l++)k=e[l],c+="<tr style='cursor: pointer;'>",(m=b.data("kgrid").multi)&&(c+="<td><input type='checkbox' class='"+b.attr("id")+"-checkbox-item'/></td>"),d.each(g,function(b,a){d.each(k,function(a,d){b==a&&(c+="<td>"+d+"</td>")})}),c+="</tr>";c+="</tbody>";b.append(c);var n=d("#"+
    b.attr("id")+" tbody tr").not(".no-item");n.click(function(){if(b.data("kgrid").multi){var a=d(d(this).children("td")[0]).children("input");a.is(":checked")?a.prop("checked",!1):a.prop("checked",!0)}else d(this).attr("class")&&-1!=d(this).attr("class").indexOf("selected")?(d(this).css("border-left",""),d(this).css("color",""),d(this).removeClass("selected")):(n.css("border-left",""),n.css("color",""),n.removeClass("selected"),d(this).css("border-left","3px solid green"),d(this).css("color","green"),
    d(this).addClass("selected"))});return b},v=function(a){d("#"+b.attr("id")+"-page").remove();var c=0,c=b.data("kgrid").type;if(1==c){if(c=a.total,void 0==c)return d.error("The total of items can not be null on jQuery.kgrid"),b}else if(2==c)c=a.items.length;else return b;if(0==c)return b;a=b.data("kgrid").pageSize;var e=Math.floor((c-1)/a+1),g=b.data("kgrid").pageNow,f=b.data("kgrid").maxPage;a="<nav id='"+b.attr("id")+"-page' class='pull-left'>";a=a+"<ul class='pagination'>"+("<li><a href='javascript:' class='"+
    b.attr("id")+"-first-page'>&laquo;</a></li>");a+="<li><a href='javascript:' class='"+b.attr("id")+"-pre-page'>&lsaquo;</a></li>";c=1*g-Math.floor(f/2);f=1*g+Math.floor(f/2);1>c&&(f+=1-c);f>e&&(c-=f-e);for(c=Math.max(1,c);c<=Math.min(e,f);c++)a=c==g?a+("<li class='active'><a href='javascript:' class='"+b.attr("id")+"-page-no'>"+c+"</a></li>"):a+("<li><a href='javascript:' class='"+b.attr("id")+"-page-no'>"+c+"</a></li>");a+="<li><a href='javascript:' class='"+b.attr("id")+"-next-page'>&rsaquo;</a></li>";
    a+="<li><a href='javascript:' class='"+b.attr("id")+"-last-page'>&raquo;</a></li>";a+="</ul></nav>";b.after(a);d("."+b.attr("id")+"-first-page").click(function(){b.kgrid("jump",1)});d("."+b.attr("id")+"-pre-page").click(function(){b.kgrid("jump",Math.max(1,1*g-1))});d("."+b.attr("id")+"-page-no").click(function(){b.kgrid("jump",d(this).text())});d("."+b.attr("id")+"-next-page").click(function(){b.kgrid("jump",Math.min(1*g+1,e))});d("."+b.attr("id")+"-last-page").click(function(){b.kgrid("jump",e)});
    return b},h=function(a,c){var d=b.data("kgrid");if(void 0!=c)d[a]=c,b.data("kgrid",d);else return eval("cfg."+a)},p={init:function(a){var c=a=d.extend({empty:"Empty item Of Search",fields:[],form:null,multi:!1,type:0,pageSize:10,maxPage:5,pageNow:1,version:"1.0.0",author:"kangyonggan",date:"2016-04-25",beforeSend:q,complete:r},a),e=c.form;e?(e=d("#"+e).attr("action"),void 0!=e?(c.url=e,b.data("kgrid",c)):d.error("The action of form can not be null on jQuery.kgrid")):d.error("The form of table can not be null on jQuery.kgrid");
    0==c.fields.length&&d.error("The fields of table can not be null on jQuery.kgrid");b.data("kgrid",a);m({items:[],total:0});return b},load:function(a){var c={},e=d("#"+b.data("kgrid").form).serializeArray();d.each(e,function(){void 0!==c[this.name]?(c[this.name].push||(c[this.name]=[c[this.name]]),c[this.name].push(this.value||"")):c[this.name]=this.value||""});if(!a||1>1*a)a=1;c.pageNow=a;c.pageSize=b.data("kgrid").pageSize;e=b.data("kgrid");e.pageNow=a;e.data=c;b.data("kgrid",e);b.data("kgrid").beforeSend(b.data("kgrid").url,
    c);d.get(b.data("kgrid").url,b.data("kgrid").data,function(a){a?(a=eval("("+a+")"),"success"==a.status?(m(a),b.data("kgrid").complete(a)):d.error("Load item failed on jQuery.kgrid")):d.error("Load item failed on jQuery.kgrid")});return b},jump:function(a){var c=b.data("kgrid").data;if(!a||1>1*a)a=1;c.pageNow=a;c.pageSize=b.data("kgrid").pageSize;var e=b.data("kgrid");e.pageNow=a;e.data=c;b.data("kgrid",e);if(2==b.data("kgrid").type)return a={items:b.kgrid("items")},m(a),b;b.data("kgrid").beforeSend(b.data("kgrid").url,
    c);d.get(b.data("kgrid").url,b.data("kgrid").data,function(a){a?(a=eval("("+a+")"),"success"==a.status?(m(a),b.data("kgrid").complete(a)):d.error("Load item failed on jQuery.kgrid")):d.error("Load item failed on jQuery.kgrid")});return b},selected:function(){for(var a=[],c=[],e=b.data("kgrid").multi,c=e?d("#"+b.attr("id")+" ."+b.attr("id")+"-checkbox-item:checked").parent().parent():d("#"+b.attr("id")+" tbody .selected"),g=0;g<c.length;g++){var f=d(c[g]).children("td"),h={},k=e?1:0;d.each(b.data("kgrid").fields,
    function(a,b){h[a]=d(f[k++]).text()});a[g]=h}return a},url:function(a){return h("url",a)},data:function(a){return h("data",a)},pageSize:function(a){return h("pageSize",a)},multi:function(a){return h("multi",a)},maxPage:function(a){return h("maxPage",a)},type:function(a){return h("type",a)},empty:function(a){return h("empty",a)},items:function(a){return h("items",a)},fields:function(a){return h("fields",a)},version:function(){return b.data("kgrid").version},author:function(){return b.data("kgrid").author},
    date:function(){return b.data("kgrid").date},beforeSend:function(a){return h("beforeSend",a)},complete:function(a){return h("complete",a)}},k=arguments[0];if(p[k])k=p[k],arguments=Array.prototype.slice.call(arguments,1);else{if("object"!=typeof k&&k)return d.error("Method "+k+" does not exist on jQuery.kgrid"),this;k=p.init}return k.apply(this,arguments)}})(jQuery);
